module.exports=[66718,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68114);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},87532,a=>{"use strict";let b=(0,a.i(70106).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);a.s(["Search",()=>b],87532)},64791,a=>{"use strict";let b=(0,a.i(70106).default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);a.s(["Video",()=>b],64791)},63519,a=>{"use strict";let b=(0,a.i(70106).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);a.s(["Phone",()=>b],63519)},26680,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(11642),e=a.i(74167),f=a.i(99570),g=a.i(66718),h=a.i(72233),i=a.i(23292),j=a.i(70106);let k=(0,j.default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var l=a.i(87532);let m=(0,j.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var n=a.i(63519),o=a.i(64791),p=a.i(45222),q=a.i(50944),r=a.i(45209),s=a.i(10738);a.s(["default",0,()=>{let{user:a}=(0,d.useAuth)(),j=(0,q.useSearchParams)().get("userId"),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(!0),D=(0,c.useRef)(null),E=()=>{setTimeout(()=>{D.current&&D.current.scrollIntoView({behavior:"smooth"})},100)};(0,c.useEffect)(()=>{a?G():C(!1)},[a]),(0,c.useEffect)(()=>{if(!B&&j){let a=t.find(a=>a.other_user?.id===j);a?w(a):F(j)}},[j,B]),(0,c.useEffect)(()=>{if(v){H(v.other_user.id);let b=e.supabase.channel(`messages:${v.other_user.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${a?.id}`},a=>{a.new.sender_id===v.other_user.id&&(y(b=>[...b,a.new]),E())}).subscribe();return()=>{b.unsubscribe()}}},[v]);let F=async a=>{let{data:b}=await e.supabase.from("profiles").select("*").eq("id",a).single();if(b){let a={other_user:b,last_message:null};w(a),u(b=>[a,...b])}},G=async()=>{try{let{data:b,error:c}=await e.supabase.from("messages").select(`
                    *,
                    sender:sender_id(id, full_name, avatar_url),
                    receiver:receiver_id(id, full_name, avatar_url)
                `).or(`sender_id.eq.${a?.id},receiver_id.eq.${a?.id}`).order("created_at",{ascending:!1});if(c)throw console.error("Error fetching conversations:",c),c;let d=new Map;b?.forEach(b=>{let c=b.sender_id===a?.id?b.receiver:b.sender;c&&!d.has(c.id)&&d.set(c.id,{other_user:c,last_message:b})});let f=Array.from(d.values());u(f)}catch(a){console.error("Error fetching conversations:",a)}finally{C(!1)}},H=async b=>{let{data:c,error:d}=await e.supabase.from("messages").select("*").or(`and(sender_id.eq.${a?.id},receiver_id.eq.${b}),and(sender_id.eq.${b},receiver_id.eq.${a?.id})`).order("created_at",{ascending:!0});d?console.error("Error fetching messages:",d):(y(c||[]),E())},I=async()=>{if(z.trim()&&v)try{let{error:b}=await e.supabase.from("messages").insert({sender_id:a?.id,receiver_id:v.other_user.id,content:z});if(b)throw b;let c={id:Date.now().toString(),sender_id:a?.id,receiver_id:v.other_user.id,content:z,created_at:new Date().toISOString()};y(a=>[...a,c]),A(""),E(),u(a=>a.map(a=>a.other_user.id===v.other_user.id?{...a,last_message:c}:a))}catch(a){console.error("Error sending message:",a),i.toast.error("Failed to send message")}};return a?(0,b.jsxs)("div",{className:"min-h-screen bg-background flex",children:[(0,b.jsx)(r.default,{}),(0,b.jsxs)("div",{className:"flex-1 flex min-w-0 h-screen",children:[(0,b.jsxs)("div",{className:"w-80 border-r border-border/40 flex flex-col bg-card/30",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-border/40",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Messages"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(l.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search messages...",className:"pl-9 bg-muted/50 border-0"})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,b.jsx)("div",{className:"p-2 space-y-2",children:t.map(c=>(0,b.jsxs)("div",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${v?.other_user?.id===c.other_user?.id?"bg-primary/10":"hover:bg-muted/50"}`,onClick:()=>c.other_user&&w(c),children:[(0,b.jsxs)(h.Avatar,{children:[(0,b.jsx)(h.AvatarImage,{src:c.other_user?.avatar_url}),(0,b.jsx)(h.AvatarFallback,{children:c.other_user?.full_name?.charAt(0)||"?"})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,b.jsx)("p",{className:"font-semibold truncate",children:c.other_user?.full_name||"Unknown User"}),c.last_message&&(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground",children:(a=>{try{if(!a)return"";let b=new Date(a);if(isNaN(b.getTime()))return"";return(0,s.formatDistanceToNow)(b,{addSuffix:!1})}catch(a){return console.error("Date formatting error",a),""}})(c.last_message.created_at)})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[c.last_message?.sender_id===a?.id?"You: ":"",c.last_message?.content||"Start a conversation"]})]})]},c.other_user?.id||Math.random()))})})]}),(0,b.jsx)("div",{className:"flex-1 flex flex-col bg-background",children:v&&v.other_user?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-4 border-b border-border/40 flex justify-between items-center bg-card/30",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(h.Avatar,{children:[(0,b.jsx)(h.AvatarImage,{src:v.other_user.avatar_url}),(0,b.jsx)(h.AvatarFallback,{children:v.other_user.full_name?.charAt(0)||"?"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold",children:v.other_user.full_name||"Unknown User"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Online"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(n.Phone,{className:"w-5 h-5"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(o.Video,{className:"w-5 h-5"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(m,{className:"w-5 h-5"})})]})]}),(0,b.jsx)("div",{className:"flex-1 p-4 overflow-y-auto",children:(0,b.jsxs)("div",{className:"space-y-4",children:[x.map((c,d)=>{let e=c.sender_id===a?.id;return(0,b.jsx)("div",{className:`flex ${e?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[70%] rounded-2xl px-4 py-2 ${e?"bg-primary text-primary-foreground rounded-tr-none":"bg-muted rounded-tl-none"}`,children:[(0,b.jsx)("p",{className:"text-sm",children:c.content}),(0,b.jsx)("p",{className:`text-[10px] mt-1 ${e?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(c.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},d)}),(0,b.jsx)("div",{ref:D})]})}),(0,b.jsx)("div",{className:"p-4 border-t border-border/40 bg-card/30",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(g.Input,{placeholder:"Type a message...",value:z,onChange:a=>A(a.target.value),onKeyDown:a=>"Enter"===a.key&&I(),className:"flex-1"}),(0,b.jsx)(f.Button,{onClick:I,size:"icon",className:"gradient-primary",children:(0,b.jsx)(k,{className:"w-4 h-4"})})]})})]}):(0,b.jsxs)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground flex-col gap-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center",children:(0,b.jsx)(p.MessageCircle,{className:"w-8 h-8"})}),(0,b.jsx)("p",{children:"Select a conversation to start messaging"})]})})]})]}):(0,b.jsx)("div",{className:"flex items-center justify-center h-screen",children:"Please log in to view messages."})}],26680)}];

//# sourceMappingURL=_ba1ad6bd._.js.map